{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Songo Info</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <script src="{% static "js/id.js" %}" type="text/javascript"></script>

</head>

<body>
  <div>
    <input type="file" id="file" multiple=multiple onchange="loadFile(this)">
    <p id="title"></p>
    <p id="artist"></p>
  </div>
  <input type="text" name="folderPath">
  <input type="submit" name="submit" value="SUBMIT">
  <script>
	var songInfo=new Array();
	
    function loadFile(input) {
		var j =0;
		var url=new Array();

		var file=new Array();
		
		for (var i = 0; i < input.files.length; i++) {
			file[i] = input.files[i];
			url[i] = file[i].urn || file[i].name;
		}
		var f = function(i){
			if(i!=input.files.length){
				var reader = new FileReader();
				reader.onload = function(event) {
					ID3.loadTags(url[i], function() {
					  showTags(url[i]);
						f(i+1);
					}, {
					  tags: ["title","artist"],
					  dataReader: FileAPIReader(file[i])
					});
				};
				reader.readAsArrayBuffer(file[i]);
			}
			else{
				for( var i=0;i<songInfo.length;i++){
					var info=songInfo[i][0]+", "+songInfo[i][1]+", "+songInfo[i][2];
					document.write("<p>"+info+"</p>");
					console.log(info);
				}
			}
		}
		f(0);
    }

function showTags(url) {
	  console.log(url);
	  var tags = ID3.getAllTags(url);
	  console.log(tags);
	  var info=new Array();
	  info.push(url);
	  info.push(tags.title);
	  info.push(tags.artist);
	 songInfo.push(info);	 
}
  </script>
</body>
</html>
